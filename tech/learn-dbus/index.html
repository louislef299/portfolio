<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Getting Started with DBus | Louis Lefebvre (✿◠‿◠)</title><meta name=title content="Getting Started with DBus"><meta name=description content="Alright, so in the past, I had gotten low enough to the system level with BlueZ
that I had pondered learning the basics of DBus(containerized ble). After working a bit with the popular
Go bluetooth pkg from tinygo, I was having some problems with it and not getting
quite getting it to work how I wanted it to, so looks like I get to learn about
DBus to help with debugging and potentially reimplement my own bluetooth Go pkg."><meta name=author content><meta name=keywords content="linux,"><meta property="og:url" content="https://louislefebvre.net/tech/learn-dbus/"><meta property="og:site_name" content="Louis Lefebvre (✿◠‿◠)"><meta property="og:title" content="Getting Started with DBus"><meta property="og:description" content="Alright, so in the past, I had gotten low enough to the system level with BlueZ that I had pondered learning the basics of DBus(containerized ble). After working a bit with the popular Go bluetooth pkg from tinygo, I was having some problems with it and not getting quite getting it to work how I wanted it to, so looks like I get to learn about DBus to help with debugging and potentially reimplement my own bluetooth Go pkg."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="tech"><meta property="article:published_time" content="2025-01-05T12:26:41-06:00"><meta property="article:modified_time" content="2025-01-05T12:26:41-06:00"><meta property="article:tag" content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="Getting Started with DBus"><meta name=twitter:description content="Alright, so in the past, I had gotten low enough to the system level with BlueZ that I had pondered learning the basics of DBus(containerized ble). After working a bit with the popular Go bluetooth pkg from tinygo, I was having some problems with it and not getting quite getting it to work how I wanted it to, so looks like I get to learn about DBus to help with debugging and potentially reimplement my own bluetooth Go pkg."><meta itemprop=name content="Getting Started with DBus"><meta itemprop=description content="Alright, so in the past, I had gotten low enough to the system level with BlueZ that I had pondered learning the basics of DBus(containerized ble). After working a bit with the popular Go bluetooth pkg from tinygo, I was having some problems with it and not getting quite getting it to work how I wanted it to, so looks like I get to learn about DBus to help with debugging and potentially reimplement my own bluetooth Go pkg."><meta itemprop=datePublished content="2025-01-05T12:26:41-06:00"><meta itemprop=dateModified content="2025-01-05T12:26:41-06:00"><meta itemprop=wordCount content="777"><meta itemprop=keywords content="Linux"><meta name=referrer content="no-referrer-when-downgrade"><link href=/original.min.css rel=stylesheet><script src=/js/d3.v3.min.js></script><script src=/js/topojson.v1.min.js></script><script src=/js/datamaps.world.min.js></script><script src=/js/familytree.js></script><link rel=stylesheet href=/css/link-button.css><link rel=stylesheet href=/css/family-tree.css></head><body><header><a class=skip-link href=#main-content>Skip to main content</a>
<a href=/ class=title><h1>Louis Lefebvre (✿◠‿◠)</h1></a><nav><button class=social-button id=socialButton>🔗</button><div class=social-icons id=socialIcons><a href=https://linkedin.com/in/louislef299 target=_blank><img src=/image/svgs/brands/linkedin.svg alt=linkedin>
</a><a href=https://github.com/louislef299 target=_blank><img src=/image/svgs/brands/github.svg alt=gitHub>
</a><a href=https://vs.co/m62q8rob target=_blank><img src=/image/svgs/brands/vsco.svg alt=vsco>
</a><a href=https://medium.com/@louislefebvre1999 target=_blank><img src=/image/svgs/brands/medium.svg alt=medium>
</a><a href=https://bsky.app/profile/louislef299.bsky.social target=_blank><img src=/image/svgs/brands/bluesky.svg alt=bluesky></a></div><script>const socialButton=document.getElementById("socialButton"),socialIcons=document.getElementById("socialIcons");socialButton.addEventListener("click",()=>{socialIcons.style.display==="none"||socialIcons.style.display===""?socialIcons.style.display="flex":socialIcons.style.display="none"})</script><a href=/family/>History</a>
<a href=/tech/>Tech</a>
<a href=/travel/>Travel</a></nav></header><main id=main-content><h1>Getting Started with DBus</h1><p class=byline><time datetime=2025-01-05 pubdate>2025-01-05</time></p><content><p>Alright, so in the past, I had gotten low enough to the system level with BlueZ
that I had pondered learning the basics of DBus(<a href=https://louislefebvre.net/tech/containerized-bluetooth/>containerized ble</a>). After working a bit with the popular
Go bluetooth pkg from tinygo, I was having some problems with it and not getting
quite getting it to work how I wanted it to, so looks like I get to learn about
DBus to help with debugging and potentially reimplement my own bluetooth Go pkg.</p><h2 id=what-is-dbus>What is DBus?</h2><p>In short, it is a generic Inter-Process Communication(IPC) used by Linux and
other operating systems and leveraging Unix domain sockets(AF_UNIX) or
TCP/IP(AF_INET).</p><p><img src=/image/linux-dbus.jpg alt="Linux DBus Architecture"></p><p>From <a href="http://0pointer.net/blog/the-new-sd-bus-api-of-systemd.html?source=post_page-----e4039c4f17dc--------------------------------">Pid Eins</a> on why DBus even exists:</p><blockquote><p>&mldr;what AF_UNIX/FIFOs are to DBus, TCP is to HTTP/REST. While AF_UNIX
sockets/FIFOs only shovel raw bytes between processes, DBus defines actual
message encoding and adds concepts like method call transactions, an object
system, security mechanisms, multicasting and more</p></blockquote><p><a href="http://0pointer.net/blog/the-new-sd-bus-api-of-systemd.html?source=post_page-----e4039c4f17dc--------------------------------">Pid Eins</a> offers a super helpful introduction to DBus concepts & terms, so I
would recommend running over there quickly to review the terms if you are
unfamiliar. Here is a reference to some of the <a href=https://dbus.freedesktop.org/doc/dbus-specification.html#standard-interfaces>standard interfaces</a> DBus
provides.</p><h2 id=interacting-with-dbus-through-the-cli>Interacting with DBus through the CLI</h2><p>Interacting with DBus is nice and easy with <code>busctl</code>. However, in order to
fully understand DBus, I&rsquo;m going to try and use the native <a href=https://linux.die.net/man/1/dbus-send>dbus-send</a> cli.</p><h3 id=listing-services>Listing Services</h3><p>First thing&rsquo;s first, I&rsquo;m going to list the active connections on the session
bus by calling the <code>ListNames</code> method of the <code>/org/freedesktop/DBus</code> object at
the <code>org.freedesktop.DBus</code> service. The <code>org.freedesktop.DBus</code> interface exposes
the <code>ListNames</code> method, allowing us to call <code>org.freedesktop.DBus.ListNames</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dbus-send --session --dest<span style=color:#f92672>=</span>org.freedesktop.DBus <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --type<span style=color:#f92672>=</span>method_call --print-reply /org/freedesktop/DBus <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  org.freedesktop.DBus.ListNames</span></span></code></pre></div><p>The two types of bus names that are returned:</p><ol><li>Unique Name(:1.685)</li><li>Well-Known Name(org.bluez)</li></ol><p>All DBus clients have a unique name, but services with a well-known name are
easier to access. Well-known names are similar to DNS in that they are only used
for message routing.</p><p>It looks like you can also find out what services exist in the DBus
configuration under <code>/usr/share/dbus-1/services</code>. One important note is when
interacting the services on the DBus, make sure you are sending those messages
on the correct bus. For instance, BlueZ will typically be using the system bus.</p><h3 id=introspection>Introspection</h3><p>DBus comes with the <a href=https://www.gnu.org/software/emacs/manual/html_node/dbus/Introspection.html>ability to analyze</a> their published interfaces, methods,
signals and properties at runtime using introspection. While the <code>dbus-send</code>
tool is powerful, I&rsquo;ve found it&rsquo;s easier to start with <code>busctl</code>. Here&rsquo;s how to
list all of the objects and introspect a BlueZ service:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ busctl tree org.bluez
</span></span><span style=display:flex><span>└─ /org
</span></span><span style=display:flex><span>  └─ /org/bluez
</span></span><span style=display:flex><span>    └─ /org/bluez/hci0
</span></span><span style=display:flex><span>$ busctl introspect org.bluez /org/bluez/hci0
</span></span><span style=display:flex><span>NAME                                TYPE      SIGNATURE RESULT/VALUE                             FLAGS
</span></span><span style=display:flex><span>org.bluez.Adapter1                  interface -         -                                        -
</span></span><span style=display:flex><span>.SetDiscoveryFilter                 method    a<span style=color:#f92672>{</span>sv<span style=color:#f92672>}</span>     -                                        -
</span></span><span style=display:flex><span>.StartDiscovery                     method    -         -                                        -
</span></span><span style=display:flex><span>.StopDiscovery                      method    -         -                                        -
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>org.freedesktop.DBus.Introspectable interface -         -                                        -
</span></span><span style=display:flex><span>.Introspect                         method    -         s                                        -
</span></span><span style=display:flex><span>org.freedesktop.DBus.Properties     interface -         -                                        -
</span></span><span style=display:flex><span>.Get                                method    ss        v                                        -
</span></span><span style=display:flex><span>.GetAll                             method    s         a<span style=color:#f92672>{</span>sv<span style=color:#f92672>}</span>                                    -</span></span></code></pre></div><p>This command returns the methods, properties and signals of the bluetooth
service. The specific type notation can be found <a href=https://pythonhosted.org/txdbus/dbus_overview.html>here</a>, but here are
the <a href=#reference-dbus-signatures>signatures</a>.</p><p>Using <code>dbus-send</code> provides some helpful insight into the arguments that are
passed to the methods. For instance, here is the xml data for the
<code>SetDiscoveryFilter</code> method:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dbus-send --system --dest<span style=color:#f92672>=</span>org.bluez --type<span style=color:#f92672>=</span>method_call --print-reply <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /org/bluez/hci0 org.freedesktop.DBus.Introspectable.Introspect</span></span></code></pre></div><p>returns:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;method</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;SetDiscoveryFilter&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;arg</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;properties&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;a{sv}&#34;</span> <span style=color:#a6e22e>direction=</span><span style=color:#e6db74>&#34;in&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/method&gt;</span></span></span></code></pre></div><h3 id=calling-a-dbus-service-method>Calling a DBus Service Method</h3><p>To call a super simple method from the <code>org.bluez</code> service, I just chose the
<code>StartDiscovery</code> method since it doesn&rsquo;t take any input parameters. Just run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>busctl call org.bluez /org/bluez/hci0 org.bluez.Adapter1 StartDiscovery</span></span></code></pre></div><p>or with <code>dbus-send</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dbus-send --system --dest<span style=color:#f92672>=</span>org.bluez --type<span style=color:#f92672>=</span>method_call --print-reply <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /org/bluez/hci0 org.bluez.Adapter1.StartDiscovery
</span></span><span style=display:flex><span>method <span style=color:#66d9ef>return</span> time<span style=color:#f92672>=</span>1736121400.427641 sender<span style=color:#f92672>=</span>:1.4 -&gt; destination<span style=color:#f92672>=</span>:1.368 serial<span style=color:#f92672>=</span><span style=color:#ae81ff>1054</span> reply_serial<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> </span></span></code></pre></div><p>Here is how you can access a DBus property, in this example, getting the
bluetooth adapter name:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dbus-send --system --dest<span style=color:#f92672>=</span>org.bluez --type<span style=color:#f92672>=</span>method_call --print-reply <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /org/bluez/hci0 org.freedesktop.DBus.Properties.Get <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    string:<span style=color:#e6db74>&#34;org.bluez.Adapter1&#34;</span> string:<span style=color:#e6db74>&#34;Name&#34;</span>
</span></span><span style=display:flex><span>method <span style=color:#66d9ef>return</span> time<span style=color:#f92672>=</span>1736121705.000813 sender<span style=color:#f92672>=</span>:1.4 -&gt; destination<span style=color:#f92672>=</span>:1.370 serial<span style=color:#f92672>=</span><span style=color:#ae81ff>1059</span> reply_serial<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>   variant       string <span style=color:#e6db74>&#34;louarch&#34;</span></span></span></code></pre></div><h2 id=signal-example-in-go>Signal Example in Go</h2><p>Since I was having the most problems with signals using BlueZ, I&rsquo;m going to run
through a quick DBus signal example using the <a href=https://pkg.go.dev/github.com/godbus/dbus>Go DBus pkg</a> by <a href=https://nyirog.medium.com/register-dbus-service-f923dfca9f1>registering my
own DBus service</a> and monitoring for signals.</p><p>This article is getting a bit large, however, so I&rsquo;m going to work with DBus in
Go in a different article.</p><h2 id=reference-dbus-signatures>Reference: DBus Signatures</h2><table><thead><tr><th>Character</th><th>Code Data Type</th></tr></thead><tbody><tr><td>y</td><td>8-bit unsigned integer</td></tr><tr><td>b</td><td>boolean value</td></tr><tr><td>n</td><td>16-bit signed integer</td></tr><tr><td>q</td><td>16-bit unsigned integer</td></tr><tr><td>i</td><td>32-bit signed integer</td></tr><tr><td>u</td><td>32-bit unsigned integer</td></tr><tr><td>x</td><td>64-bit signed integer</td></tr><tr><td>t</td><td>64-bit unsigned integer</td></tr><tr><td>d</td><td>double-precision floating point (IEEE 754)</td></tr><tr><td>s</td><td>UTF-8 string (no embedded nul characters)</td></tr><tr><td>o</td><td>DBus Object Path string</td></tr><tr><td>g</td><td>DBus Signature string</td></tr><tr><td>a</td><td>Array</td></tr><tr><td>(</td><td>Structure start</td></tr><tr><td>)</td><td>Structure end</td></tr><tr><td>v</td><td>Variant type (described below)</td></tr><tr><td>{</td><td>Dictionary/Map begin</td></tr><tr><td>}</td><td>Dictionary/Map end</td></tr><tr><td>h</td><td>Unix file descriptor</td></tr></tbody></table></content><p><a class=blog-tags href=/tags/linux/>#linux</a></p><p><a href='mailto:louislefebvre1999@gmail.com?subject=Reply%20to%20"Getting%20Started%20with%20DBus"'>Reply to this post by email ↪</a></p></main><footer><small>2023 Louis LeFebvre | Made With ❤️ and <a href=https://clente.github.io/hugo-bearcub/>ᕦʕ •ᴥ•ʔᕤ</a></small></footer></body></html>