<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Dependabot Auto-Merge | Louis Lefebvre (✿◠‿◠)</title>
<meta name=title content="Dependabot Auto-Merge"><meta name=description content="In this post, I&rsquo;m just going to go through automating dependabot updates and
leveraging merge queue so that I don&rsquo;t have to mess around with rebasing and
conflicts. Hoping this will just work natively, but let&rsquo;s try it out!
The project I spend the most time keeping up-to-date is aws-sso, so this
should make my life easier by only needing to execute the release. Side note: I
really should write a doc on how to use that tool."><meta name=author content><meta name=keywords content="github,"><meta property="og:url" content="https://louislefebvre.net/tech/dependabot-merge-queue/"><meta property="og:site_name" content="Louis Lefebvre (✿◠‿◠)"><meta property="og:title" content="Dependabot Auto-Merge"><meta property="og:description" content="In this post, I’m just going to go through automating dependabot updates and leveraging merge queue so that I don’t have to mess around with rebasing and conflicts. Hoping this will just work natively, but let’s try it out!
The project I spend the most time keeping up-to-date is aws-sso, so this should make my life easier by only needing to execute the release. Side note: I really should write a doc on how to use that tool."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="tech"><meta property="article:published_time" content="2024-12-15T09:32:18-06:00"><meta property="article:modified_time" content="2024-12-15T09:32:18-06:00"><meta property="article:tag" content="Github"><meta name=twitter:card content="summary"><meta name=twitter:title content="Dependabot Auto-Merge"><meta name=twitter:description content="In this post, I’m just going to go through automating dependabot updates and leveraging merge queue so that I don’t have to mess around with rebasing and conflicts. Hoping this will just work natively, but let’s try it out!
The project I spend the most time keeping up-to-date is aws-sso, so this should make my life easier by only needing to execute the release. Side note: I really should write a doc on how to use that tool."><meta itemprop=name content="Dependabot Auto-Merge"><meta itemprop=description content="In this post, I’m just going to go through automating dependabot updates and leveraging merge queue so that I don’t have to mess around with rebasing and conflicts. Hoping this will just work natively, but let’s try it out!
The project I spend the most time keeping up-to-date is aws-sso, so this should make my life easier by only needing to execute the release. Side note: I really should write a doc on how to use that tool."><meta itemprop=datePublished content="2024-12-15T09:32:18-06:00"><meta itemprop=dateModified content="2024-12-15T09:32:18-06:00"><meta itemprop=wordCount content="407"><meta itemprop=keywords content="Github"><meta name=referrer content="no-referrer-when-downgrade"><link href=/original.min.css rel=stylesheet><script src=/js/d3.v3.min.js></script><script src=/js/topojson.v1.min.js></script><script src=/js/datamaps.world.min.js></script></head><body><header><a class=skip-link href=#main-content>Skip to main content</a>
<a href=/ class=title><h1>Louis Lefebvre (✿◠‿◠)</h1></a><nav><a href=/tech/>Tech</a>
<a href=/travel/>Travel</a></nav></header><main id=main-content><h1>Dependabot Auto-Merge</h1><p class=byline><time datetime=2024-12-15 pubdate>2024-12-15</time></p><content><p>In this post, I&rsquo;m just going to go through <a href=https://docs.github.com/en/code-security/dependabot/working-with-dependabot/automating-dependabot-with-github-actions>automating dependabot updates</a> and
leveraging <a href=https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/configuring-pull-request-merges/managing-a-merge-queue>merge queue</a> so that I don&rsquo;t have to mess around with rebasing and
conflicts. Hoping this will just work natively, but let&rsquo;s try it out!</p><p>The project I spend the most time keeping up-to-date is <a href=https://github.com/louhttps://github.com/louislef299/aws-ssoislef299/aws-sso>aws-sso</a>, so this
should make my life easier by only needing to execute the release. Side note: I
really should write a doc on how to use that tool.</p><h2 id=research>Research</h2><p>Alright, so after a little research, I quickly realized that merge queues <a href=https://medium.com/@kojoru/how-to-set-up-merge-queues-in-github-actions-59381e5f435a>aren&rsquo;t
supported for personal repositories</a>.</p><blockquote><p>Firstly, you need to have a repository that is either a private repository in
a GitHub Enterprise-licensed organization or a public repository in any
organization. Personal repositories don’t support that feature at all, even
public ones or if you have a Pro subscription.</p></blockquote><p>So, that changed up the approach a bit. Simplified things a little bit.</p><h2 id=implementation>Implementation</h2><p>The action ended up looking a bit like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Dependabot Automation</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>: <span style=color:#ae81ff>pull_request</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>permissions</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>contents</span>: <span style=color:#ae81ff>write</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>pull-requests</span>: <span style=color:#ae81ff>write</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>dependabot</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>if</span>: <span style=color:#ae81ff>github.event.pull_request.user.login == &#39;dependabot[bot]&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>PR_URL</span>: <span style=color:#ae81ff>${{ github.event.pull_request.html_url }}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>GH_TOKEN</span>: <span style=color:#ae81ff>${{ secrets.GITHUB_TOKEN }}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Dependabot metadata</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>id</span>: <span style=color:#ae81ff>metadata</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>dependabot/fetch-metadata@v2.2.0</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>github-token</span>: <span style=color:#e6db74>&#34;${{ secrets.GITHUB_TOKEN }}&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Enable auto-merge for Dependabot PRs</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>run</span>: <span style=color:#ae81ff>gh pr merge --auto --squash &#34;$PR_URL&#34;</span></span></span></code></pre></div><p>The one thing that I was concerned about when enabling this feature was if there
would be any race conditions in merging. That&rsquo;s why I had hoped to try out Merge
Queues a bit, but I think GitHub is smart enough to simply require the branch be
updated to match the base branch and Dependabot should auto-rebase the branch.
So far, it seems to work without a hitch, but the real test will be next week
when new updates come up.</p><p>For my project, I don&rsquo;t require any approvals since I&rsquo;m the only contributor,
but if you would need a PR approval, you can add one step to run before
auto-merging:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Approve a PR</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>run</span>: <span style=color:#ae81ff>gh pr review --approve &#34;$PR_URL&#34;</span></span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>That was super easy! Makes my life better as an open-source contributor and I
can definitely see the benefits to bringing this back to the workplace. One
requirement to have before enabling this would be thorough testing and
integration testing as to not accidentally introduce bad code. With trunk-based
development practices and release-please for manual releases, this is pretty
safe automation and nothing but a positive imo.</p></content><p><a class=blog-tags href=/tags/github/>#github</a></p><p><a href='mailto:louislefebvre1999@gmail.com?subject=Reply%20to%20"Dependabot%20Auto-Merge"'>Reply to this post by email ↪</a></p></main><footer><small>2023 Louis LeFebvre | Made With ❤️ and <a href=https://clente.github.io/hugo-bearcub/>ᕦʕ •ᴥ•ʔᕤ</a></small></footer></body></html>