<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Exploring Dual Bluetooth Roles on One Device | Louis Lefebvre</title>
<meta name=title content="Exploring Dual Bluetooth Roles on One Device"><meta name=description content="Today, I am going to attempt to containerize a bluetooth application using
Docker. I&rsquo;ve been learning about the bluetooth protocol using Go and simply copy the Go Central code to my
raspberry pi and run it with Go and Bluez. It works, but it&rsquo;s not easy to
transport since it typically requires the hard-coding of the wifi network into
the pi image. Since I travel around a lot, this should be more flexible and
allow me to publish the container so I can pull it down from any machine(that
runs a container runtime)."><meta name=author content><meta name=keywords content="networking,ble,linux,"><meta property="og:url" content="https://louislefebvre.net/tech/containerized-bluetooth/"><meta property="og:site_name" content="Louis Lefebvre"><meta property="og:title" content="Exploring Dual Bluetooth Roles on One Device"><meta property="og:description" content="Today, I am going to attempt to containerize a bluetooth application using Docker. I’ve been learning about the bluetooth protocol using Go and simply copy the Go Central code to my raspberry pi and run it with Go and Bluez. It works, but it’s not easy to transport since it typically requires the hard-coding of the wifi network into the pi image. Since I travel around a lot, this should be more flexible and allow me to publish the container so I can pull it down from any machine(that runs a container runtime)."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="tech"><meta property="article:published_time" content="2024-12-28T16:08:53-06:00"><meta property="article:modified_time" content="2024-12-28T16:08:53-06:00"><meta property="article:tag" content="Networking"><meta property="article:tag" content="Ble"><meta property="article:tag" content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="Exploring Dual Bluetooth Roles on One Device"><meta name=twitter:description content="Today, I am going to attempt to containerize a bluetooth application using Docker. I’ve been learning about the bluetooth protocol using Go and simply copy the Go Central code to my raspberry pi and run it with Go and Bluez. It works, but it’s not easy to transport since it typically requires the hard-coding of the wifi network into the pi image. Since I travel around a lot, this should be more flexible and allow me to publish the container so I can pull it down from any machine(that runs a container runtime)."><meta itemprop=name content="Exploring Dual Bluetooth Roles on One Device"><meta itemprop=description content="Today, I am going to attempt to containerize a bluetooth application using Docker. I’ve been learning about the bluetooth protocol using Go and simply copy the Go Central code to my raspberry pi and run it with Go and Bluez. It works, but it’s not easy to transport since it typically requires the hard-coding of the wifi network into the pi image. Since I travel around a lot, this should be more flexible and allow me to publish the container so I can pull it down from any machine(that runs a container runtime)."><meta itemprop=datePublished content="2024-12-28T16:08:53-06:00"><meta itemprop=dateModified content="2024-12-28T16:08:53-06:00"><meta itemprop=wordCount content="610"><meta itemprop=keywords content="Networking,Ble,Linux"><meta name=referrer content="no-referrer-when-downgrade"><link href=/original.min.css rel=stylesheet><script src=/js/d3.v3.min.js></script><script src=/js/topojson.v1.min.js></script><script src=/js/datamaps.world.min.js></script></head><body><header><a class=skip-link href=#main-content>Skip to main content</a>
<a href=/ class=title><h1>Louis Lefebvre</h1></a><nav><a href=/tech/>Tech</a>
<a href=/travel/>Travel</a></nav></header><main id=main-content><h1>Exploring Dual Bluetooth Roles on One Device</h1><p class=byline><time datetime=2024-12-28 pubdate>2024-12-28</time></p><content><p>Today, I am going to attempt to <a href=https://medium.com/omi-uulm/how-to-run-containerized-bluetooth-applications-with-bluez-dced9ab767f6>containerize a bluetooth application</a> using
Docker. I&rsquo;ve been <a href=https://louislefebvre.net/tech/simple-bluetooth/>learning about the bluetooth protocol using Go</a> and simply copy the Go Central code to my
raspberry pi and run it with Go and Bluez. It works, but it&rsquo;s not easy to
transport since it typically requires the hard-coding of the wifi network into
the pi image. Since I travel around a lot, this should be more flexible and
allow me to publish the container so I can pull it down from any machine(that
runs a container runtime).</p><h2 id=reading-through-the-article>Reading through the article</h2><p>An initial note: the author linked a Microsoft article about Cloud Native
applications and.. that was a bit unnerving.</p><p>Basically, this article is a great reference point to understanding <a href=https://www.bluez.org/>Bluez</a>.
It was honestly an interesting approach to sharing a single bluetooth adapter
with mutliple containers on a single node. The idea is there is one bluetooth
service that runs on the node that communicates with other services over a REST
API. Cool architecture, but not really what I directly need.</p><p>The recommended approach to actually running everything locally is to have
multiple adapters so, let&rsquo;s take a look at my system and see if I can get around
interacting with the D-Bus.</p><h2 id=understanding-device-specifications>Understanding Device Specifications</h2><p>My current kernal release is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>louis@louarch1<span style=color:#f92672>]</span>$ uname -r
</span></span><span style=display:flex><span>6.12.6-arch1-1</span></span></code></pre></div><p>With the <code>bluetoothctl list</code> and <code>bluetoothctl show</code> commands, I was able to
learn that I only have one bluetooth adapter on my device but, it supports both
the central and peripheral roles.</p><p>To write bluetooth code in Go on the same device that acts as a central and
peripheral, I can use the <a href=https://git.kernel.org/pub/scm/bluetooth/bluez.git/tree/doc/org.bluez.Device.rst>D-Bus API exposed by BlueZ</a>. BlueZ provides D-Bus
interfaces for interacting with Bluetooth devices, managing connections, and
handling GATT services for both the central and peripheral roles. Seems a little
complex for something so simple.</p><h2 id=stepping-back-a-bit>Stepping back a bit</h2><p>Alright if I&rsquo;m working directly with the D-Bus to interact with BlueZ, I think
the solution may be more complex than it needs to be. Decided to step back a bit
a just use the old solution I had. Just a combination of <a href=https://tailscale.com/kb/1151/what-is-tailscale>tailscale</a> hosts on
my local network that can interact with the pi zeros over bluetooth and ssh.
That way, as long as the tailnet is up and running, I should always have access
to the raspberry pis.</p><pre tabindex=0><code class=language-ascii data-lang=ascii>+--------------------+
|   Local Computer   |
|  +---------------+ |
|  |   SSH Client  | |
|  +---------------+ |             
+--------------------+             
         |
         | Tailnet
         |
+--------------------+   
|   Tailscale Host   |    
|    (Jump Host)     |    
|  +---------------+ |    
|  |   SSH Client  |&lt;--------------+    
|  +---------------+ |             |    
+--------------------+ Bluetooth   |    
                                   |
+------------------------+         |
| Raspberry Pi Zero 1    |&lt;--------+
|(Bluetooth, SSH, BlueZ) |         |
+------------------------+         |
                                   |
+------------------------+         |
| Raspberry Pi Zero 2    |&lt;--------+
|(Bluetooth, SSH, BlueZ) |         |
+------------------------+         |
                                   |
+------------------------+         |
| Raspberry Pi Zero 3    |&lt;--------+
|(Bluetooth, SSH, BlueZ) | 
+------------------------+  </code></pre><p>It brought up a good excuse to reformat that new laptop I got my hands on. My
current main node in my home lab isn&rsquo;t super reliable, but if I made that new
laptop the main node, it could be more reliable, I would have access to a direct
interface if things start going wrong instead of having to HDMI into the TV and
crack out the keyboard and mouse.</p><h2 id=conclusion>Conclusion</h2><p>Well, funny to come around to the same conclusion I had had before this
experiment. Luckily I learned some information about BlueZ and bluetooth in
general. If I had more time and more of a care, I would definitely look further
into the D-Bus API solution, but for now I&rsquo;ll leave it for another time.</p></content><p><a class=blog-tags href=/tags/networking/>#networking</a>
<a class=blog-tags href=/tags/ble/>#ble</a>
<a class=blog-tags href=/tags/linux/>#linux</a></p><p><a href='mailto:louislefebvre1999@gmail.com?subject=Reply%20to%20"Exploring%20Dual%20Bluetooth%20Roles%20on%20One%20Device"'>Reply to this post by email ↪</a></p></main><footer><small>2023 Louis LeFebvre | Made With ❤️ and <a href=https://clente.github.io/hugo-bearcub/>ᕦʕ •ᴥ•ʔᕤ</a></small></footer></body></html>