<!doctype html><html lang=en-us><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Building a Custom BLE Service in Go | Louis Lefebvre (✿◠‿◠)</title>
<meta name=title content="Building a Custom BLE Service in Go"><meta name=description content="In this article we will be creating a custom Bluetooth Service in Go. I&rsquo;ll be
walking through the NovelBits article and use the tinygo pkg.
The requirements I have for my current project require a custom Bluetooth
Service as none of the pre-defined services from Bluetooth SIG cover my use
case.
About Services
In the past, I had gone over bluetooth services and characteristics, so I
understand services from a high level, but good to go over it quickly."><meta name=author content><meta name=keywords content="go,ble,"><meta property="og:url" content="https://louislefebvre.net/tech/go-ble-custom-service/"><meta property="og:site_name" content="Louis Lefebvre (✿◠‿◠)"><meta property="og:title" content="Building a Custom BLE Service in Go"><meta property="og:description" content="In this article we will be creating a custom Bluetooth Service in Go. I’ll be walking through the NovelBits article and use the tinygo pkg. The requirements I have for my current project require a custom Bluetooth Service as none of the pre-defined services from Bluetooth SIG cover my use case.
About Services In the past, I had gone over bluetooth services and characteristics, so I understand services from a high level, but good to go over it quickly."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="tech"><meta property="article:published_time" content="2024-12-30T14:03:17-06:00"><meta property="article:modified_time" content="2024-12-30T14:03:17-06:00"><meta property="article:tag" content="Go"><meta property="article:tag" content="Ble"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building a Custom BLE Service in Go"><meta name=twitter:description content="In this article we will be creating a custom Bluetooth Service in Go. I’ll be walking through the NovelBits article and use the tinygo pkg. The requirements I have for my current project require a custom Bluetooth Service as none of the pre-defined services from Bluetooth SIG cover my use case.
About Services In the past, I had gone over bluetooth services and characteristics, so I understand services from a high level, but good to go over it quickly."><meta itemprop=name content="Building a Custom BLE Service in Go"><meta itemprop=description content="In this article we will be creating a custom Bluetooth Service in Go. I’ll be walking through the NovelBits article and use the tinygo pkg. The requirements I have for my current project require a custom Bluetooth Service as none of the pre-defined services from Bluetooth SIG cover my use case.
About Services In the past, I had gone over bluetooth services and characteristics, so I understand services from a high level, but good to go over it quickly."><meta itemprop=datePublished content="2024-12-30T14:03:17-06:00"><meta itemprop=dateModified content="2024-12-30T14:03:17-06:00"><meta itemprop=wordCount content="473"><meta itemprop=keywords content="Go,Ble"><meta name=referrer content="no-referrer-when-downgrade"><link href=/original.min.css rel=stylesheet><script src=/js/d3.v3.min.js></script><script src=/js/topojson.v1.min.js></script><script src=/js/datamaps.world.min.js></script><link rel=stylesheet href=/css/link-button.css></head><body><header><a class=skip-link href=#main-content>Skip to main content</a>
<a href=/ class=title><h1>Louis Lefebvre (✿◠‿◠)</h1></a><nav><button class=social-button id=socialButton>🔗</button><div class=social-icons id=socialIcons><a href=https://linkedin.com/in/louislef299 target=_blank><img src=/image/svgs/brands/linkedin.svg alt=linkedin>
</a><a href=https://github.com/louislef299 target=_blank><img src=/image/svgs/brands/github.svg alt=gitHub>
</a><a href=https://vs.co/m62q8rob target=_blank><img src=/image/svgs/brands/vsco.svg alt=vsco>
</a><a href=https://medium.com/@louislefebvre1999 target=_blank><img src=/image/svgs/brands/medium.svg alt=medium>
</a><a href=https://bsky.app/profile/louislef299.bsky.social target=_blank><img src=/image/svgs/brands/bluesky.svg alt=bluesky></a></div><script>const socialButton=document.getElementById("socialButton"),socialIcons=document.getElementById("socialIcons");socialButton.addEventListener("click",()=>{socialIcons.style.display==="none"||socialIcons.style.display===""?socialIcons.style.display="flex":socialIcons.style.display="none"})</script><a href=/tech/>Tech</a>
<a href=/travel/>Travel</a></nav></header><main id=main-content><h1>Building a Custom BLE Service in Go</h1><p class=byline><time datetime=2024-12-30 pubdate>2024-12-30</time></p><content><p>In this article we will be creating a custom Bluetooth Service in Go. I&rsquo;ll be
walking through the <a href=https://novelbits.io/bluetooth-gatt-services-characteristics/>NovelBits article</a> and use the <a href=https://pkg.go.dev/tinygo.org/x/bluetooth>tinygo pkg</a>.
The requirements I have for my current project require a custom Bluetooth
Service as none of the pre-defined services from <a href="https://www.bluetooth.com/wp-content/uploads/Files/Specification/HTML/Assigned_Numbers/out/en/Assigned_Numbers.pdf?v=1735501678042">Bluetooth SIG</a> cover my use
case.</p><h2 id=about-services>About Services</h2><p>In the past, I had <a href=https://louislefebvre.net/tech/simple-bluetooth/#notes-on-gatt>gone over bluetooth services and characteristics</a>, so I
understand services from a high level, but good to go over it quickly.</p><p>Services are conceptual entities that groups together one or more
attributes/characteristics. Each service is distinguished by a UUID that is
either 16-bits in length for officially adopted BLE services or 128-bits long
for custom services. To avoid confusion, bluetooth profiles are simple services
that are pre-defined by the Bluetooth SIG community. From <a href=https://novelbits.io/bluetooth-gatt-services-characteristics/>NovelBits</a>:</p><blockquote><p>A service also contains other attributes (non-characteristics) that help
structure the data within a service (such as service declarations,
characteristic declarations, and others).</p></blockquote><h2 id=writing-a-custom-service-using-tinygo>Writing a Custom Service using tinygo</h2><p>Creating a custom service is fairly simple and just requires the creation of a
custom UUID. Once the association has to happen with the bluetooth adapter is
when things get interesting.</p><p>The <a href=https://pkg.go.dev/tinygo.org/x/bluetooth#CharacteristicConfig>CharacteristicConfig</a> is broken down as follows:</p><ul><li>Handle: A reference to the characteristic, which can be used to identify the
characteristic in the service.</li><li>UUID: The unique identifier for the characteristic. It&rsquo;s typically a 16-bit or
128-bit UUID that identifies the type of data the characteristic will hold.</li><li>Value: The initial value of the characteristic, often provided as a byte slice
([]byte).</li><li>Flags: Flags that define the permissions of the characteristic. These specify
which operations are allowed, such as reading, writing, and notifying.</li><li>WriteEvent: A callback function that is triggered when data is written to the
characteristic. It allows you to handle incoming data and take action based on
the received value.</li></ul><p>Here is an implementation example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>currentTime</span> = <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// addCustomService defines and adds a custom Bluetooth service to a BLE
</span></span></span><span style=display:flex><span><span style=color:#75715e>// adapter.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>addCustomService</span>(<span style=color:#a6e22e>adapter</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bluetooth</span>.<span style=color:#a6e22e>Adapter</span>, <span style=color:#a6e22e>characteristic</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>bluetooth</span>.<span style=color:#a6e22e>Characteristic</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// create custom uuids(partially redacted)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>characteristicUUID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bluetooth</span>.<span style=color:#a6e22e>NewUUID</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>serviceUUID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bluetooth</span>.<span style=color:#a6e22e>NewUUID</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// enable interaction with this time-based characteristic by adding the
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// service to the adapter
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>adapter</span>.<span style=color:#a6e22e>AddService</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>bluetooth</span>.<span style=color:#a6e22e>Service</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>UUID</span>: <span style=color:#a6e22e>serviceUUID</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Characteristics</span>: []<span style=color:#a6e22e>bluetooth</span>.<span style=color:#a6e22e>CharacteristicConfig</span>{{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Handle</span>: <span style=color:#a6e22e>characteristic</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>UUID</span>:   <span style=color:#a6e22e>characteristicUUID</span>,
</span></span><span style=display:flex><span>            <span style=color:#75715e>// add default value to characteristic
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>Value</span>:  []byte(<span style=color:#a6e22e>currentTime</span>.<span style=color:#a6e22e>Format</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>RFC3339</span>)),
</span></span><span style=display:flex><span>            <span style=color:#75715e>// grant read, write, and write-without-response permissions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>Flags</span>:  <span style=color:#a6e22e>bluetooth</span>.<span style=color:#a6e22e>CharacteristicReadPermission</span> | <span style=color:#a6e22e>bluetooth</span>.<span style=color:#a6e22e>CharacteristicWritePermission</span> | <span style=color:#a6e22e>bluetooth</span>.<span style=color:#a6e22e>CharacteristicWriteWithoutResponsePermission</span>,
</span></span><span style=display:flex><span>            <span style=color:#75715e>// when a write request is made to the characteristic, it attempts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// to parse the received time string and, if the new time is later
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// than the current time, updates the currentTime variable with the
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// new value
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>WriteEvent</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>client</span> <span style=color:#a6e22e>bluetooth</span>.<span style=color:#a6e22e>Connection</span>, <span style=color:#a6e22e>offset</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>value</span> []<span style=color:#66d9ef>byte</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Parse</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>RFC3339</span>, string(<span style=color:#a6e22e>value</span>))
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;couldn&#39;t parse time:&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>After</span>(<span style=color:#a6e22e>currentTime</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;changing the current time to %s\n&#34;</span>, <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Format</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>RFC3339</span>))
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>currentTime</span> = <span style=color:#a6e22e>t</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }},
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}</span></span></code></pre></div></content><p><a class=blog-tags href=/tags/go/>#go</a>
<a class=blog-tags href=/tags/ble/>#ble</a></p><p><a href='mailto:louislefebvre1999@gmail.com?subject=Reply%20to%20"Building%20a%20Custom%20BLE%20Service%20in%20Go"'>Reply to this post by email ↪</a></p></main><footer><small>2023 Louis LeFebvre | Made With ❤️ and <a href=https://clente.github.io/hugo-bearcub/>ᕦʕ •ᴥ•ʔᕤ</a></small></footer></body></html>